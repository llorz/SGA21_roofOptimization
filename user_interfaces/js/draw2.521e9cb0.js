(function(t){function e(e){for(var s,o,r=e[0],c=e[1],l=e[2],d=0,u=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&u.push(n[o][0]),n[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);h&&h(e);while(u.length)u.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],s=!0,r=1;r<i.length;r++){var c=i[r];0!==n[c]&&(s=!1)}s&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},n={draw2:0},a=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(i,s,function(e){return t[e]}.bind(null,s));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var h=c;a.push([2,"chunk-vendors"]),i()})({"0e8b":function(t,e,i){"use strict";i.r(e);i("68de"),i("e583"),i("0bd5"),i("836b"),i("9b42"),i("139e"),i("fae9"),i("3ff7"),i("d6dc");var s=i("c0a4"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main"},[i("ahead",{staticClass:"ahead",staticStyle:{display:"flex"}},[i("el-row",{staticStyle:{width:"400px"}},[i("el-col",{attrs:{span:7}},[i("el-radio-group",{staticStyle:{padding:"20px 10p",width:"100px"},attrs:{size:"medium"},model:{value:t.editmode,callback:function(e){t.editmode=e},expression:"editmode"}},[i("el-radio",{attrs:{label:"points"}}),i("el-radio",{attrs:{label:"faces"}})],1)],1),i("el-button",{attrs:{size:"mini"},on:{click:t.clear_cache}},[t._v("clear")]),i("el-button",{attrs:{size:"mini"},on:{click:t.save_to_verts}},[t._v("save points")]),i("el-button",{attrs:{size:"mini"},on:{click:t.save_to_faces}},[t._v("save faces")])],1)],1),i("container",{staticStyle:{display:"flex"}},[i("aside",{staticClass:"aside"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"points"==t.editmode,expression:"editmode=='points'"}],staticClass:"aside_pts"},t._l(t.geoInfo.pts,(function(e,s){return i("el-row",{key:s,staticClass:"row"},[i("el-col",{attrs:{span:2}},[i("span",[t._v(t._s(s))])]),i("el-col",{attrs:{span:18}},[i("span",{staticStyle:{color:"#871F78"}},[t._v(t._s(e.x+","+e.y))])]),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(e){return t.hdl_pts_del(s)}}})],1)],1)})),1),i("div",{directives:[{name:"show",rawName:"v-show",value:"faces"==t.editmode,expression:"editmode=='faces'"}],staticClass:"aside_pts"},t._l(t.geoInfo.ploygons,(function(e,s){return i("el-row",{key:s,staticClass:"row"},[i("el-col",{attrs:{span:2}},[i("span",[t._v(t._s(s))])]),i("el-col",{attrs:{span:18}},[i("span",{staticStyle:{color:"#871F78"}},[t._v(t._s(e.join(",")))])]),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(e){return t.hdl_faces_del(s)}}})],1)],1)})),1)]),i("content",{staticClass:"content"},[i("el-row",[t._v("file name:"),i("span",{staticStyle:{color:"red"}},[t._v(t._s(this.img.fname))])]),i("el-row",{staticClass:"info"},[i("el-col",{attrs:{span:4}},[t._v("current location")]),i("el-col",{attrs:{span:2}},[t._v("x:"),i("span",{staticStyle:{color:"red"}},[t._v(t._s(t.mouse.x))])]),i("el-col",{attrs:{span:3}},[t._v("y:"),i("span",{staticStyle:{color:"red"}},[t._v(t._s(t.mouse.y))])]),i("el-col",{attrs:{span:9}},[t._v("closest point:"),i("span",{staticStyle:{color:"red"}},[t._v(t._s(t.getNearstPt))])])],1),i("div",{staticClass:"imgshow",style:{height:t.imgHei,width:t.imgWid},on:{dragover:t.hdl_dragover_pic,drop:t.hdl_drop_pic}},[i("canvas",{ref:"canvas1",staticClass:"imgshow_canvas",attrs:{id:"canvas1"},on:{mousemove:t.hdl_canvas_move,mousedown:t.hdl_canvas_down,contextmenu:function(t){t.preventDefault()}}})])],1)])],1)},a=[],o=(i("72b3"),i("a543"),i("cca2"),i("6540"),i("5184"),i("989e"),i("1d7a"),i("402f"),i("2db5"),i("270f"),i("6ab7"),i("f32d"),{name:"app",data:function(){return{mouse:{x:0,y:0},editmode:"faces",img:{url:"",fname:"xxx",height:600,width:600},geoInfo:{pts:[{x:100,y:40,pic:!1},{x:50,y:200,pic:!1},{x:80,y:300,pic:!1},{x:120,y:400,pic:!1},{x:200,y:450,pic:!1},{x:300,y:450,pic:!1},{x:550,y:400,pic:!1},{x:550,y:100,pic:!1}],ploygons:[[0,1],[3,4]]},backPic:null,dom_canvas:null,ctx:null,dom_thnumbnail:null,image:null,nearstPt:[],drawInfo:{mouseradius:10,overmax:1e3},styles:{pt:{medi:"rgba(250,0,255,0.7)",active:"rgba(150,240,99,0.7)",default:"rgba(255,0,0,0.8)"},line:{medi:"rgba(250,0,255,0.7)",default:"rgba(rgba(28,229,213,0.75))",active:"rgba(250,133,199,0.7)"}},cacheLines:[3]}},mounted:function(){this.clear_cache()},created:function(){var t=this,e=this;this.$nextTick((function(){e.dom_canvas=e.$refs.canvas1,e.ctx=e.dom_canvas.getContext("2d"),t.drawCanvas()})),this.image=new Image,this.image.onload=this.imageonload},watch:{editmode:{handler:function(t,e){this.drawCanvas()}},mouse:{handler:function(t,e){this.drawCanvas()},deep:!0},getMediPts:{handler:function(t,e){this.drawCanvas()},deep:!0},geoInfo:{handler:function(t,e){this.drawCanvas()},deep:!0}},methods:{exportRaw:function(t,e){var i=window.URL||window.webkitURL||window,s=new Blob([e]),n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=i.createObjectURL(s),n.download=t,this.fakeClick(n)},fakeClick:function(t){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(e)},clear_cache:function(){this.geoInfo.pts=[],this.geoInfo.ploygons=[],this.cacheLines=[]},save_to_verts:function(){var t=this.geoInfo.pts.reduce((function(t,e){return t+=e.x+" "+e.y+"\n",t}),"");this.exportRaw(this.img.fname+".outline",t)},save_to_faces:function(){var t=this.geoInfo.ploygons.reduce((function(t,e){return t+=e.join(", ")+"\n",t}),"");this.exportRaw(this.img.fname+".adjacency",t)},imageonload:function(){this.img.height=this.image.height,this.img.width=this.image.width,document.getElementById("canvas1").setAttribute("width",this.img.width),document.getElementById("canvas1").setAttribute("height",this.img.height),this.ctx.drawImage(this.image,0,0,this.img.width,this.img.height),this.backPic=this.ctx.getImageData(0,0,this.img.width,this.img.height),this.drawCanvas()},drawCanvas:function(){this.ctx.clearRect(0,0,this.img.width,this.img.height),this.backPic&&this.ctx.putImageData(this.backPic,0,0),this.drawPts(),this.drawLines(),this.drawMediPts(),"points"!==this.editmode&&this.drawPloygons(),this.drawMouseRect()},drawPts:function(){var t=this;this.ctx.font="15px Arial",this.geoInfo.pts.map((function(e,i){var s=i===t.getNearstPt?t.styles.pt.active:t.styles.pt["default"];t.ctx.fillStyle=s,t.ctx.fillText(i,e.x+5,e.y+4),t.drawPt(e,s)}))},drawMediPts:function(){var t=this;if(this.getMediPts.forEach((function(e,i){if(i<t.getMediPts.length-1){var s=i===t.getNearstMediPt?t.styles.pt.active:t.styles.pt.medi;t.ctx.fillStyle=s,t.ctx.fillText("C"+i,e.x+5,e.y+4),t.drawPt(e,s)}})),"faces"==this.editmode){var e=this.geoInfo.pts.length-1,i=e===this.getNearstMediPt?this.styles.pt.active:this.styles.pt.medi;this.ctx.fillStyle=i,this.ctx.fillText("C"+e,this.getMediPts[e].x+5,this.getMediPts[e].y+4),this.drawPt(this.getMediPts[e],i)}},drawPt:function(t,e){var i=5,s={x:t.x-i,y:t.y-i},n={x:t.x+i,y:t.y+i},a={x:s.x,y:n.y},o={x:n.x,y:s.y};this.drawLine(s,n,e),this.drawLine(a,o,e),this.ctx.rect(t.x-2,t.y-2,4,4),this.ctx.stroke()},drawLines:function(){for(var t=this.geoInfo.pts.length,e=0;e<t-1;e++)this.drawLine(this.geoInfo.pts[e],this.geoInfo.pts[e+1],this.styles.line["default"]);"faces"==this.editmode&&this.drawLine(this.geoInfo.pts[t-1],this.geoInfo.pts[0],this.styles.line["default"])},drawLine:function(t,e,i){this.ctx.fillStyle,this.ctx.strokeStyle;this.ctx.lineWidth=2,this.ctx.fillStyle=i,this.ctx.strokeStyle=i,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.closePath(),this.ctx.stroke()},drawPloygons:function(){var t=this;this.geoInfo.ploygons.map((function(e){var i=t.getMediPts[e[0]],s=t.getMediPts[e[1]];t.drawLine(i,s,t.styles.line["default"])}))},drawMouseRect:function(){var t=this.drawInfo.mouseradius;this.ctx.beginPath(),this.ctx.rect(this.mouse.x-t,this.mouse.y-t,2*t,2*t),this.ctx.closePath(),this.ctx.stroke(),this.drawPt(this.mouse,this.styles.pt["default"])},hdl_pts_del:function(t){this.geoInfo.pts.splice(t,1)},hdl_faces_del:function(t){this.geoInfo.ploygons.splice(t,1)},hdl_dragover_pic:function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},hdl_drop_pic:function(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer.files,i=e[0];this.img.fname=i.name;var s=new FileReader;s.readAsDataURL(i);var n=this;s.onload=function(t){n.image.src=s.result}},hdl_canvas_move:function(t){this.mouse={x:t.clientX-this.dom_canvas.offsetLeft,y:t.clientY-this.dom_canvas.offsetTop}},hdl_canvas_down:function(t){t.stopPropagation(),t.preventDefault(),"points"==this.editmode?0==t.button?this.getNearstPt>-1?this.geoInfo.pts[this.getNearstPt]=this.mouse:this.geoInfo.pts.push(this.mouse):2==t.button&&this.geoInfo.pts.splice(this.getNearstPt,1):"faces"==this.editmode&&this.getNearstMediPt>-1&&0==t.button&&(0==this.cacheLines.length?this.cacheLines.push(this.getNearstMediPt):1==this.cacheLines.length&&this.cacheLines[0]!==this.getNearstMediPt&&(this.geoInfo.ploygons.push([this.cacheLines[0],this.getNearstMediPt]),this.cacheLines=[]))},ptInRect:function(t,e,i){return t.x>e.x-i&&t.x<e.x+i&&t.y>e.y-i&&t.y<e.y+i},getLineCenter:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}},computed:{imgHei:function(){return this.img.height+"px"},imgWid:function(){return this.img.width+"px"},getMediPts:function(){var t=this,e=[],i=this.geoInfo.pts.length;return i>2&&this.geoInfo.pts.forEach((function(s,n){var a=n===i-1?0:n+1;e.push(t.getLineCenter(s,t.geoInfo.pts[a]))})),e},getNearstMediPt:function(){var t=this.drawInfo.mouseradius,e=this.drawInfo.overmax,i=[],s=this;return this.getMediPts.forEach((function(n){if(s.ptInRect(s.mouse,n,t)){var a=s.mouse.x-n.x;a*=a;var o=s.mouse.y-n.y;o*=o,i.push(o+a)}else i.push(e)})),Math.min.apply(Math,i)<e?i.indexOf(Math.min.apply(Math,i)):-1},getNearstPt:function(){var t=this.drawInfo.mouseradius,e=this.drawInfo.overmax,i=[],s=this;return this.geoInfo.pts.forEach((function(n){if(s.ptInRect(s.mouse,n,t)){var a=s.mouse.x-n.x;a*=a;var o=s.mouse.y-n.y;o*=o,i.push(o+a)}else i.push(e)})),Math.min.apply(Math,i)<e?i.indexOf(Math.min.apply(Math,i)):-1}}}),r=o,c=(i("8329"),i("c701")),l=Object(c["a"])(r,n,a,!1,null,null,null),h=l.exports,d=i("32e7"),u=i("e1fd"),f=i.n(u);i("f56d");s["default"].prototype.$d3=d,window.d3=d,s["default"].use(f.a),s["default"].config.productionTip=!1,Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t},new s["default"]({render:function(t){return t(h)}}).$mount("#app")},2:function(t,e,i){t.exports=i("0e8b")},"73bd":function(t,e,i){},8329:function(t,e,i){"use strict";i("73bd")}});
//# sourceMappingURL=draw2.521e9cb0.js.map